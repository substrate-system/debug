# debug
[![tests](https://img.shields.io/github/actions/workflow/status/substrate-system/debug/nodejs.yml?style=flat-square)](https://github.com/substrate-system/debug/actions/workflows/nodejs.yml)
[![module](https://img.shields.io/badge/module-ESM-blue?style=flat-square)](README.md)
[![types](https://img.shields.io/npm/types/@substrate-system/debug?style=flat-square)](README.md)
[![semantic versioning](https://img.shields.io/badge/semver-2.0.0-blue?logo=semver&style=flat-square)](https://semver.org/)
[![install size](https://flat.badgen.net/packagephobia/install/@substrate-system/debug)](https://packagephobia.com/result?p=@substrate-system/debug)
[![GZip size](https://flat.badgen.net/bundlephobia/minzip/@substrate-system/web-component)](https://bundlephobia.com/package/@substrate-system/web-component)
[![license](https://img.shields.io/badge/license-Big_Time-blue?style=flat-square)](LICENSE)


A tiny JavaScript debugging utility that works in Node.js and browsers.
Use environment variables to control logging in Node.js, and localStorage
to control logging in browsers, so there are no ridiculous console log 
statements in production.

This is based on [debug](https://github.com/debug-js/debug).
It's been rewritten to use contemporary JS.

In the browser, this uses localStorage to control debug output.
In Node.js, it uses the environment variable `DEBUG`.

**Featuring:**
* Use [exports](https://github.com/substrate-system/debug/blob/main/package.json#L31)
  field in `package.json` to choose node JS or browser version
* ESM only

Plus, [see the docs](https://substrate-system.github.io/debug/)
generated by typescript.

## Contents

<!-- toc -->

- [Install](#install)
- [Browser](#browser)
  * [Factor out of production](#factor-out-of-production)
- [Node JS](#node-js)
- [Config](#config)
  * [Namespace](#namespace)
  * [Enable all namespaces](#enable-all-namespaces)
  * [Enable specific namespaces](#enable-specific-namespaces)
  * [Force logging with boolean true](#force-logging-with-boolean-true)
- [Develop](#develop)
  * [browser](#browser)
  * [Run the Node example](#run-the-node-example)
- [Test](#test)
  * [Node](#node)

<!-- tocstop -->

## Install

```sh
npm i -D @substrate-system/debug
```

**Browser usage**: Use `localStorage` `DEBUG` key.
**Node.js usage**: Use environment variable `DEBUG`.

## Browser

In the browser, this looks for the `DEBUG` key in `localStorage`.

```js
import Debug from '@substrate-system/debug'

// Set DEBUG in localStorage
localStorage.setItem('DEBUG', 'myapp:*')

const debug = Debug('myapp:component')
debug('hello logs')
// will log, because DEBUG in localStorage matches 'myapp:*'
```

### Factor out of production

Use dynamic imoprts to keep this out of your production code.

```ts
import type { Debugger } from '@substrate-system/debug'

let debug:Debugger
if (import.meta.env.DEV) {
  const Debug = await import('/example/debug.js')
  debug = Debug('myApplication:abc')
} else {
  debug = function noop (...args:any[]) {}
}
```


## Node JS
Run your script with an env variable, `DEBUG`.

```js
// in node JS
import createDebug from '@substrate-system/debug/node'
const debug = createDebug('fooo')
debug('testing')
```

Call this with an env var of `DEBUG=fooo`
```sh
DEBUG=fooo node ./test/fixture/node.js
```

## Config

### Namespace
In browsers, this checks `localStorage` for `DEBUG` key. In Node.js, this checks
the environment variable `DEBUG`.

```js
import Debug from '@substrate-system/debug'

// In browser: checks localStorage.getItem('DEBUG')
const debug = Debug('example')

// Log if no namespace is set in localStorage
const debug = Debug(import.meta.env.DEV)
```

### Enable all namespaces

```js
localStorage.setItem('DEBUG', '*')
```

### Enable specific namespaces
```js
localStorage.setItem('DEBUG', 'myapp:auth,myapp:api')
```

### Force logging with boolean true

You can also pass `true` to force logging regardless of `localStorage`.
For example, in Vite, this will log on your localhost server, but not
in production:

```js
const debug = Debug(import.meta.env.DEV)
debug('This logs')
```

------------------------------------------------------------------


## Develop

### browser
Start a `vite` server and log some things. This uses
[the example directory](./example/).

```sh
npm start
```

### Run the Node example

```sh
npx esbuild --platform=node --bundle ./example/node.ts | DEBUG="hello:*" node
```

Try it with a different env var to see different logs:

```sh
npx esbuild --platform=node --bundle ./example/node.ts | DEBUG="hello:*,abc123:*" node
```


or

```sh
npm run example:node
```


## Test

### Node

Run tests:

```sh
npm test
```
